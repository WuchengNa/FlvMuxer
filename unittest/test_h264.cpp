#include "common.h"
#include "h264/h264_nalu_splitor.h"

TEST(h264, NALUSplitor) {
    uint8_t data[] = {0x00, 0x00, 0x00, 0x01, 0x67,
                    0x07, 0x07, 0x07, 0x07, 0x68,
                    0x07, 0x07, 0x07, 0x07, 0x68,
                    0x07, 0x07, 0x07, 0x07, 0x68,
                    0x00, 0x00, 0x00, 0x01, 0x68,
                    0x07, 0x07, 0x07, 0x07, 0x68,
                    0x07, 0x07, 0x07, 0x07, 0x68,
                    0x07, 0x07, 0x07, 0x07, 0x68,
                    0x00, 0x00, 0x00, 0x01, 0x65,
                    0x07, 0x07, 0x07, 0x07, 0x68,
                    0x07, 0x07, 0x07, 0x07, 0x68,
                    0x07, 0x07, 0x07, 0x07, 0x68};
    size_t size = sizeof(data) / sizeof(data[0]);
    
    H264NALUSplitor splitor(data, size);
    EXPECT_TRUE(splitor.Split());
    
    auto nalu_list = splitor.GetNALUs();
    EXPECT_EQ(nalu_list.size(), 2);
    
    EXPECT_EQ(nalu_list[0].nalu_type_, 5);
    EXPECT_EQ(nalu_list[1].nalu_type_, 6);
}